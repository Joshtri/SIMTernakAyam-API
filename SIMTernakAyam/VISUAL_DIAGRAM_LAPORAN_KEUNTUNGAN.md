# ?? VISUAL DIAGRAM: Laporan Keuntungan Kosong

## ?? FLOW DIAGRAM - PERHITUNGAN KEUNTUNGAN

```
???????????????????????????????????????????????????????????????????
?  REQUEST: GET /api/harga_pasar/laporan-keuntungan-bulanan      ?
?  Params: tahun=2025, bulan=12                                   ?
???????????????????????????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????????
?  STEP 1: Ambil Data Panen dari Database                         ?
?  ? Ditemukan: 3 panen pada 2025-12-10                          ?
?  ? Total: 2,962 ekor ayam, 6,219.20 kg                         ?
???????????????????????????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????????
?  STEP 2: Untuk Setiap Panen, Cari Harga Pasar                  ?
?                                                                  ?
?  Query: GetHargaAktifByTanggalAsync(2025-12-10)                ?
?  Kondisi:                                                        ?
?    - IsAktif = true                                             ?
?    - TanggalMulai <= 2025-12-10                                 ?
?    - TanggalBerakhir = null OR >= 2025-12-10                    ?
???????????????????????????????????????????????????????????????????
                            ?
                ?????????????????????????
                ?                       ?
                ?                       ?
    ??????????????????????  ??????????????????????
    ?  ? TIDAK ADA      ?  ?  ? ADA HARGA      ?
    ?  HARGA PASAR       ?  ?  PASAR             ?
    ??????????????????????  ??????????????????????
                ?                       ?
                ?                       ?
    ??????????????????????  ??????????????????????
    ?  hargaPerKg = 0    ?  ?  hargaPerKg = 27000?
    ?  totalPendapatan=0 ?  ?  totalPendapatan=  ?
    ?  hargaPasarInfo=   ?  ?    totalBerat ×    ?
    ?     null           ?  ?    hargaPerKg      ?
    ??????????????????????  ??????????????????????
                ?                       ?
                ?????????????????????????
                            ?
???????????????????????????????????????????????????????????????????
?  STEP 3: Return Response                                         ?
?                                                                  ?
?  ? SEBELUM FIX:                                                ?
?  {                                                               ?
?    "totalPendapatan": 0,                                        ?
?    "hargaPerKg": 0,                                             ?
?    "hargaPasarInfo": null                                       ?
?  }                                                               ?
?                                                                  ?
?  ? SETELAH FIX:                                                ?
?  {                                                               ?
?    "totalPendapatan": 167918400,                                ?
?    "hargaPerKg": 27000,                                         ?
?    "hargaPasarInfo": { ... }                                    ?
?  }                                                               ?
???????????????????????????????????????????????????????????????????
```

---

## ??? DATABASE STATE COMPARISON

### ? SEBELUM FIX (Masalah)

```
???????????????????????????????????????????????????????????????
?  TABLE: HargaPasar                                           ?
???????????????????????????????????????????????????????????????
?  (EMPTY atau harga tidak mencakup tanggal 2025-12-10)      ?
?                                                              ?
?  Kemungkinan:                                                ?
?  1. Tidak ada record sama sekali                            ?
?  2. Ada record tapi TanggalMulai > 2025-12-10               ?
?  3. Ada record tapi TanggalBerakhir < 2025-12-10            ?
?  4. Ada record tapi IsAktif = false                         ?
???????????????????????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????
?  QUERY RESULT: NULL                                          ?
???????????????????????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????
?  IMPACT: Keuntungan = 0                                      ?
???????????????????????????????????????????????????????????????
```

### ? SETELAH FIX (Solusi)

```
???????????????????????????????????????????????????????????????????????????????
?  TABLE: HargaPasar                                                           ?
???????????????????????????????????????????????????????????????????????????????
?  Id                | HargaPerKg | TanggalMulai | TanggalBerakhir | IsAktif ?
?  guid-xxx          | 27000      | 2025-12-01   | null            | true    ?
???????????????????????????????????????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????????
?  QUERY RESULT: HargaPasar Object                                ?
?  {                                                               ?
?    "id": "guid-xxx",                                            ?
?    "hargaPerKg": 27000,                                         ?
?    "tanggalMulai": "2025-12-01",                                ?
?    "tanggalBerakhir": null,                                     ?
?    "isAktif": true                                              ?
?  }                                                               ?
???????????????????????????????????????????????????????????????????
                            ?
                            ?
???????????????????????????????????????????????????????????????????
?  IMPACT: Keuntungan = 6,219.20 kg × Rp 27,000 = Rp 167,918,400?
???????????????????????????????????????????????????????????????????
```

---

## ?? TIMELINE VISUALIZATION

```
Timeline Harga Pasar vs Tanggal Panen
???????????????????????????????????????????????????????????????????

? SCENARIO 1: TIDAK ADA HARGA PASAR
????????????????????????????????????????????????????????????????
                                        ?? 2025-12-10 (Tanggal Panen)
                                        ?
    (No data in database)               ?
                                        ? Tidak ada harga pasar
                                        
    Result: totalPendapatan = 0


? SCENARIO 2: ADA HARGA PASAR YANG VALID
????????????????????????????????????????????????????????????????
                                        ?? 2025-12-10 (Tanggal Panen)
                                        ?
    ??????????????????????????????????????????????????????????
    ? HargaPasar: Rp 27,000/kg                               ?
    ? TanggalMulai: 2025-12-01                               ?
    ? TanggalBerakhir: null (berlaku terus)                  ?
    ? IsAktif: true                                          ?
    ??????????????????????????????????????????????????????????
    
    Result: totalPendapatan = 6,219.20 × 27,000 = 167,918,400


? SCENARIO 3: HARGA PASAR EXPIRED
????????????????????????????????????????????????????????????????
                                        ?? 2025-12-10 (Tanggal Panen)
                                        ?
    ?????????????????????????           ?
    ? HargaPasar: Rp 26,000 ?           ? Expired, tidak valid
    ? TanggalMulai: 2024-12-01          
    ? TanggalBerakhir: 2024-12-31 ????? Sudah lewat
    ? IsAktif: true         ?           
    ?????????????????????????           
    
    Result: totalPendapatan = 0


? SCENARIO 4: MULTIPLE HARGA PASAR (BEST PRACTICE)
????????????????????????????????????????????????????????????????
                                        ?? 2025-12-10 (Tanggal Panen)
                                        ?
    ?????????????????????????           ?   ??????????????????????
    ? Harga Nov 2025        ?           ?   ? Harga Des 2025     ?
    ? Rp 26,500/kg          ?           ?   ? Rp 27,000/kg       ?
    ? 2025-11-01 - 2025-11-30          ?   ? 2025-12-01 - null  ?
    ? IsAktif: false        ?           ?   ? IsAktif: true      ?
    ?????????????????????????           ?  ??????????????????????
                                        
    Result: totalPendapatan = 6,219.20 × 27,000 = 167,918,400
    (Menggunakan harga Des 2025 karena yang aktif)
```

---

## ?? DATA FLOW DIAGRAM

```
??????????????????????????????????????????????????????????????????????
?                         USER REQUEST                                ?
?  GET /api/harga_pasar/laporan-keuntungan-bulanan?tahun=2025&12    ?
??????????????????????????????????????????????????????????????????????
                                ?
                                ?
??????????????????????????????????????????????????????????????????????
?                     HargaPasarController                            ?
?  • Terima request                                                   ?
?  • Validasi parameter                                               ?
?  • Panggil service                                                  ?
??????????????????????????????????????????????????????????????????????
                                ?
                                ?
??????????????????????????????????????????????????????????????????????
?                     HargaPasarService                               ?
?  • GetLaporanKeuntunganBulananAsync(2025, 12)                     ?
?  • Loop setiap panen:                                               ?
?      - Ambil harga pasar untuk tanggal panen                       ?
?      - Hitung keuntungan jika ada harga                            ?
?      - Set 0 jika tidak ada harga                                  ?
??????????????????????????????????????????????????????????????????????
                                ?
                    ?????????????????????????
                    ?                       ?
??????????????????????????????  ????????????????????????????
?  PanenRepository            ?  ?  HargaPasarRepository    ?
?  • GetByDateRangeAsync()    ?  ?  • GetHargaAktifBy       ?
?  • Return: List<Panen>      ?  ?    TanggalAsync()        ?
?                             ?  ?  • Return: HargaPasar?   ?
??????????????????????????????  ????????????????????????????
                    ?                       ?
                    ?????????????????????????
                                ?
??????????????????????????????????????????????????????????????????????
?                         DATABASE                                    ?
?  ????????????????      ???????????????????                        ?
?  ? Panen Table  ?      ? HargaPasar Table?                        ?
?  ????????????????      ???????????????????                        ?
?  ? 3 records    ?      ? ? 0 records    ?  (MASALAH)             ?
?  ? 2025-12-10   ?      ?    (atau tidak  ?                        ?
?  ?              ?      ?     valid)      ?                        ?
?  ????????????????      ???????????????????                        ?
??????????????????????????????????????????????????????????????????????
                                ?
                                ?
??????????????????????????????????????????????????????????????????????
?                     RESPONSE (MASALAH)                              ?
?  {                                                                  ?
?    "totalPendapatan": 0,           ?                              ?
?    "hargaPerKg": 0,                ?                              ?
?    "hargaPasarInfo": null,         ?                              ?
?    "detailPanen": [                                                 ?
?      { "totalPendapatan": 0 },     ?                              ?
?      { "totalPendapatan": 0 },     ?                              ?
?      { "totalPendapatan": 0 }      ?                              ?
?    ]                                                                ?
?  }                                                                  ?
??????????????????????????????????????????????????????????????????????
```

---

## ??? FIX DIAGRAM

```
??????????????????????????????????????????????????????????????????????
?                         SOLUSI: INSERT HARGA PASAR                  ?
?                                                                     ?
?  POST /api/harga_pasar                                             ?
?  {                                                                  ?
?    "hargaPerKg": 27000,                                            ?
?    "tanggalMulai": "2025-12-01T00:00:00Z",                        ?
?    "tanggalBerakhir": null,                                        ?
?    "isAktif": true                                                 ?
?  }                                                                  ?
??????????????????????????????????????????????????????????????????????
                                ?
                                ?
??????????????????????????????????????????????????????????????????????
?                         DATABASE                                    ?
?  ????????????????      ???????????????????????????????????        ?
?  ? Panen Table  ?      ? HargaPasar Table                ?        ?
?  ????????????????      ???????????????????????????????????        ?
?  ? 3 records    ?      ? ? 1 NEW RECORD                 ?        ?
?  ? 2025-12-10   ?      ?    Id: guid-xxx                 ?        ?
?  ?              ?      ?    HargaPerKg: 27000            ?        ?
?  ?              ?      ?    TanggalMulai: 2025-12-01     ?        ?
?  ?              ?      ?    TanggalBerakhir: null        ?        ?
?  ?              ?      ?    IsAktif: true                ?        ?
?  ????????????????      ???????????????????????????????????        ?
??????????????????????????????????????????????????????????????????????
                                ?
                                ?
??????????????????????????????????????????????????????????????????????
?              TEST ULANG: GET laporan-keuntungan-bulanan            ?
??????????????????????????????????????????????????????????????????????
                                ?
                                ?
??????????????????????????????????????????????????????????????????????
?                     RESPONSE (FIXED)                                ?
?  {                                                                  ?
?    "totalPendapatan": 167918400,   ? TERISI                       ?
?    "hargaPerKg": 27000,            ? TERISI                       ?
?    "hargaPasarInfo": {             ? TERISI                       ?
?      "id": "guid-xxx",                                             ?
?      "hargaPerKg": 27000,                                          ?
?      "tanggalMulai": "2025-12-01"                                  ?
?    },                                                               ?
?    "detailPanen": [                                                 ?
?      { "totalPendapatan": 56133000 },  ? TERISI                  ?
?      { "totalPendapatan": 58271400 },  ? TERISI                  ?
?      { "totalPendapatan": 53514000 }   ? TERISI                  ?
?    ]                                                                ?
?  }                                                                  ?
??????????????????????????????????????????????????????????????????????
```

---

## ?? KEY POINTS

### ? Penyebab Masalah:
1. Tidak ada record di table `HargaPasar`
2. Atau record ada tapi tidak memenuhi kondisi:
   - `IsAktif = false`
   - `TanggalMulai > 2025-12-10`
   - `TanggalBerakhir < 2025-12-10`

### ? Solusi:
1. Buat record `HargaPasar` baru dengan:
   - `IsAktif = true`
   - `TanggalMulai <= 2025-12-10`
   - `TanggalBerakhir = null` atau `>= 2025-12-10`

### ?? Maintenance:
- Pastikan hanya ada **1 harga pasar aktif** pada satu waktu
- Update harga pasar secara berkala sesuai perubahan harga pasar riil
- Gunakan `TanggalBerakhir = null` untuk harga yang berlaku hingga update berikutnya

---

**Created:** 2025-12-14  
**For:** Troubleshooting Laporan Keuntungan Kosong Issue
